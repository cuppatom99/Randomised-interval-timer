<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interval Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #74b72e;
            color: white;
            text-align: center;
        }
        #timer {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        #status {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 1.5rem;
            background-color: #61dafb;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div>
        <div id="timer">10</div>
        <div id="status">Get Ready</div>
        <div>
            <label for="sets">Number of Sets:</label>
            <input type="number" id="sets" min="1" value="3">
        </div>
        <br>
        <button onclick="startTimer()">Start Timer</button>
    </div>

    <script>
        let sets;
        let currentSet = 0;
        let totalSetDuration = 180; // 3 minutes in seconds
        let remainingTime;
        let interval;
        let countdown = 10; // 10 second countdown
        let isWorkPeriod = true;
        let workPeriods = [];
        let restPeriods = [];
        
        const timerElement = document.getElementById('timer');
        const statusElement = document.getElementById('status');
        const setsInput = document.getElementById('sets');

        function startTimer() {
            sets = parseInt(setsInput.value);
            currentSet = 0;
            statusElement.textContent = 'Get Ready';
            remainingTime = countdown;
            timerElement.textContent = remainingTime;
            interval = setInterval(countdownTimer, 1000);
        }

        function countdownTimer() {
            remainingTime--;
            timerElement.textContent = remainingTime;
            playBeep();

            if (remainingTime <= 0) {
                clearInterval(interval);
                startSet();
            }
        }

        function startSet() {
            if (currentSet < sets) {
                workPeriods = [];
                restPeriods = [];
                let remainingSetTime = totalSetDuration;

                while (remainingSetTime > 0) {
                    let workTime = getRandomInt(5, 30); // Random work period between 5 and 30 seconds
                    if (remainingSetTime - workTime <= 0) {
                        workTime = remainingSetTime;
                    }
                    workPeriods.push(workTime);
                    remainingSetTime -= workTime;

                    let restTime = getRandomInt(5, 20); // Random rest period between 5 and 20 seconds
                    if (remainingSetTime - restTime <= 0) {
                        restTime = remainingSetTime;
                    }
                    restPeriods.push(restTime);
                    remainingSetTime -= restTime;
                }

                statusElement.textContent = 'Work';
                isWorkPeriod = true;
                remainingTime = workPeriods.shift();
                timerElement.textContent = remainingTime;
                interval = setInterval(runInterval, 1000);
            } else {
                statusElement.textContent = 'Workout Complete!';
                timerElement.textContent = '';
            }
        }

        function runInterval() {
            remainingTime--;
            timerElement.textContent = remainingTime;
            playBeep();

            if (remainingTime <= 0) {
                clearInterval(interval);
                if (isWorkPeriod) {
                    if (restPeriods.length > 0) {
                        statusElement.textContent = 'Rest';
                        remainingTime = restPeriods.shift();
                        isWorkPeriod = false;
                    } else {
                        currentSet++;
                        startSet();
                        return;
                    }
                } else {
                    if (workPeriods.length > 0) {
                        statusElement.textContent = 'Work';
                        remainingTime = workPeriods.shift();
                        isWorkPeriod = true;
                    } else {
                        currentSet++;
                        startSet();
                        return;
                    }
                }
                timerElement.textContent = remainingTime;
                interval = setInterval(runInterval, 1000);
            }
        }

        function playBeep() {
            if (remainingTime <= 10 && remainingTime > 0) {
                const beep = new AudioContext();
                const oscillator = beep.createOscillator();
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(500, beep.currentTime); // 500 Hz beep
                oscillator.connect(beep.destination);
                oscillator.start();
                oscillator.stop(beep.currentTime + 0.1); // Beep lasts 0.1 seconds
            } else if (remainingTime === 0) {
                const beep = new AudioContext();
                const oscillator = beep.createOscillator();
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(1000, beep.currentTime); // 1000 Hz beep
                oscillator.connect(beep.destination);
                oscillator.start();
                oscillator.stop(beep.currentTime + 0.4); // Beep lasts 0.4 seconds
            }
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>
